<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rograndec.feijiayun.chain.business.retail.special.dao.SpecialRegisterMapper">
  <resultMap id="BaseResultMap" type="com.rograndec.feijiayun.chain.business.retail.special.entity.SpecialRegister">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="enterprise_id" jdbcType="BIGINT" property="enterpriseId" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
    <result column="order_type" jdbcType="INTEGER" property="orderType" />
    <result column="register_date" jdbcType="TIMESTAMP" property="registerDate" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="base_order_id" jdbcType="BIGINT" property="baseOrderId" />
    <result column="base_order_type" jdbcType="INTEGER" property="baseOrderType" />
    <result column="base_order_code" jdbcType="VARCHAR" property="baseOrderCode" />
    <result column="base_order_date" jdbcType="TIMESTAMP" property="baseOrderDate" />
    <result column="register_man_id" jdbcType="BIGINT" property="registerManId" />
    <result column="register_man_code" jdbcType="VARCHAR" property="registerManCode" />
    <result column="register_man_name" jdbcType="VARCHAR" property="registerManName" />
    <result column="member_id" jdbcType="BIGINT" property="memberId" />
    <result column="member_card_code" jdbcType="VARCHAR" property="memberCardCode" />
    <result column="member_name" jdbcType="VARCHAR" property="memberName" />
    <result column="consumer_name" jdbcType="VARCHAR" property="consumerName" />
    <result column="sex" jdbcType="INTEGER" property="sex" />
    <result column="age" jdbcType="INTEGER" property="age" />
    <result column="id_num" jdbcType="VARCHAR" property="idNum" />
    <result column="quantity_total" jdbcType="DECIMAL" property="quantityTotal" />
    <result column="varieties_quantity" jdbcType="INTEGER" property="varietiesQuantity" />
    <result column="amount_total" jdbcType="DECIMAL" property="amountTotal" />
    <result column="whole_discount" jdbcType="DECIMAL" property="wholeDiscount" />
    <result column="whole_discount_amount" jdbcType="DECIMAL" property="wholeDiscountAmount" />
    <result column="real_amount_total" jdbcType="DECIMAL" property="realAmountTotal" />
    <result column="notax_real_amount_total" jdbcType="DECIMAL" property="notaxRealAmountTotal" />
    <result column="tax_amount_total" jdbcType="DECIMAL" property="taxAmountTotal" />
    <result column="profit_total" jdbcType="DECIMAL" property="profitTotal" />
    <result column="notax_profit_total" jdbcType="DECIMAL" property="notaxProfitTotal" />
    <result column="profit_rate" jdbcType="DECIMAL" property="profitRate" />
    <result column="notax_profit_rate" jdbcType="DECIMAL" property="notaxProfitRate" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="creater_id" jdbcType="BIGINT" property="createrId" />
    <result column="creater_code" jdbcType="VARCHAR" property="createrCode" />
    <result column="creater_name" jdbcType="VARCHAR" property="createrName" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="modifier_id" jdbcType="BIGINT" property="modifierId" />
    <result column="modifier_code" jdbcType="VARCHAR" property="modifierCode" />
    <result column="modifier_name" jdbcType="VARCHAR" property="modifierName" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="member_card_code" jdbcType="VARCHAR" property="memberCardCode" />
  </resultMap>

  <resultMap id="SpecialRegisterVo" type="com.rograndec.feijiayun.chain.business.retail.special.vo.SpecialRegisterVO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="enterprise_id" jdbcType="BIGINT" property="enterpriseId" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
    <result column="order_type" jdbcType="INTEGER" property="orderType" />
    <result column="register_date" jdbcType="TIMESTAMP" property="registerDate" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="base_order_id" jdbcType="BIGINT" property="baseOrderId" />
    <result column="base_order_type" jdbcType="INTEGER" property="baseOrderType" />
    <result column="base_order_code" jdbcType="VARCHAR" property="baseOrderCode" />
    <result column="base_order_date" jdbcType="TIMESTAMP" property="baseOrderDate" />
    <result column="register_man_id" jdbcType="BIGINT" property="registerManId" />
    <result column="register_man_code" jdbcType="VARCHAR" property="registerManCode" />
    <result column="register_man_name" jdbcType="VARCHAR" property="registerManName" />
    <result column="member_card_code" jdbcType="VARCHAR" property="memberCardCode" />
    <result column="consumer_name" jdbcType="VARCHAR" property="consumerName" />
    <result column="sex" jdbcType="INTEGER" property="sex" />
    <result column="age" jdbcType="INTEGER" property="age" />
    <result column="id_num" jdbcType="VARCHAR" property="idNum" />
    <result column="quantity_total" jdbcType="DECIMAL" property="quantityTotal" />
    <result column="varieties_quantity" jdbcType="INTEGER" property="varietiesQuantity" />
    <result column="amount_total" jdbcType="DECIMAL" property="amountTotal" />
    <result column="whole_discount" jdbcType="DECIMAL" property="wholeDiscount" />
    <result column="whole_discount_amount" jdbcType="DECIMAL" property="wholeDiscountAmount" />
    <result column="real_amount_total" jdbcType="DECIMAL" property="realAmountTotal" />
    <result column="notax_real_amount_total" jdbcType="DECIMAL" property="notaxRealAmountTotal" />
    <result column="tax_amount_total" jdbcType="DECIMAL" property="taxAmountTotal" />
    <result column="profit_total" jdbcType="DECIMAL" property="profitTotal" />
    <result column="notax_profit_total" jdbcType="DECIMAL" property="notaxProfitTotal" />
    <result column="profit_rate" jdbcType="DECIMAL" property="profitRate" />
    <result column="notax_profit_rate" jdbcType="DECIMAL" property="notaxProfitRate" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="sale_code" jdbcType="VARCHAR" property="saleCode" />
    <result column="member_card_code" jdbcType="VARCHAR" property="memberCardCode" />
  </resultMap>
  
  <resultMap id="POSSpecialRegisterDataResultMap" type="com.rograndec.feijiayun.chain.inf.pos.special.vo.POSSpecialRegisterVO">
  	  <result column="id" jdbcType="BIGINT" property="id" />
  	  <result column="renterprise_id" jdbcType="BIGINT" property="enterpriseId" />
  	  <result column="rparent_id" jdbcType="BIGINT" property="parentId" />
  	  <result column="register_date" jdbcType="TIMESTAMP" property="registerDate" />
  	  <result column="code" jdbcType="VARCHAR" property="code" />
  	  <result column="member_id" jdbcType="BIGINT" property="memberId" />
  	  <result column="member_card_code" jdbcType="VARCHAR" property="memberCardCode" />
  	  <result column="member_name" jdbcType="VARCHAR" property="memberName" />
      <result column="consumer_name" jdbcType="VARCHAR" property="consumerName" />
  	  <result column="sex" jdbcType="INTEGER" property="sex" />
  	  <result column="age" jdbcType="INTEGER" property="age" />
  	  <result column="id_num" jdbcType="VARCHAR" property="idNum" />
  	  
  	  <result column="quantity_total" jdbcType="DECIMAL" property="quantityTotal" />
      <result column="amount_total" jdbcType="DECIMAL" property="amountTotal" />
      <result column="whole_discount" jdbcType="DECIMAL" property="wholeDiscount" />
      <result column="whole_discount_amount" jdbcType="DECIMAL" property="wholeDiscountAmount" />
      <result column="real_amount_total" jdbcType="DECIMAL" property="realAmountTotal" />
  	  
      <collection property="detailList" ofType="com.rograndec.feijiayun.chain.inf.pos.prescription.vo.PrescriptionDetailVO">
        <result column="detail_id" jdbcType="BIGINT" property="detailId" />
        <result column="shelf_table_id" jdbcType="BIGINT" property="shelfTableId" />
        <result column="senterprise_id" jdbcType="BIGINT" property="enterpriseId" />
  	    <result column="sparent_id" jdbcType="BIGINT" property="parentId" />
  	    <result column="goods_id" jdbcType="BIGINT" property="goodsId" />
        <result column="goods_code" jdbcType="VARCHAR" property="goodsCode" />
        <result column="goods_name" jdbcType="VARCHAR" property="goodsName" />
        <result column="goods_generic_name" jdbcType="VARCHAR" property="goodsGenericName" />
        <result column="dosage_name" jdbcType="VARCHAR" property="dosageName" />
        <result column="unit_name" jdbcType="VARCHAR" property="unitName" />
        <result column="goods_specification" jdbcType="VARCHAR" property="goodsSpecification" />
        <result column="manufacturer" jdbcType="VARCHAR" property="manufacturer" />
        <result column="single_dose" jdbcType="DECIMAL" property="singleDose" />
        <result column="quantity" jdbcType="DECIMAL" property="quantity" />
        <result column="unit_price" jdbcType="DECIMAL" property="unitPrice" />
        <result column="line_discount" jdbcType="DECIMAL" property="lineDiscount" />
        <result column="amount" jdbcType="DECIMAL" property="amount" />
        <result column="lot_number" jdbcType="VARCHAR" property="lotNumber" />
        <result column="product_date" jdbcType="TIMESTAMP" property="productDate" />
        <result column="valid_date" jdbcType="TIMESTAMP" property="validDate" />
        
        <result column="shelf_id" jdbcType="BIGINT" property="shelfId" />
        <result column="shelf_name" jdbcType="VARCHAR" property="shelfName" />
      </collection>
  </resultMap>
  
  <sql id="Base_Column_List">
    id, enterprise_id, parent_id, order_type, register_date, code, base_order_id, base_order_type, 
    base_order_code, base_order_date, register_man_id, register_man_code, register_man_name,
    member_id,member_card_code,member_name,
    consumer_name, sex, age, id_num, quantity_total, varieties_quantity, amount_total, 
    whole_discount, whole_discount_amount, real_amount_total, notax_real_amount_total, 
    tax_amount_total, profit_total, notax_profit_total, profit_rate, notax_profit_rate, 
    status, remark, creater_id, creater_code, creater_name, create_time, modifier_id, 
    modifier_code, modifier_name, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from saas_special_register
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from saas_special_register
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.rograndec.feijiayun.chain.business.retail.special.entity.SpecialRegister" useGeneratedKeys="true" keyProperty="id">
    insert into saas_special_register (id, enterprise_id, parent_id, 
      order_type, register_date, code, 
      base_order_id, base_order_type, base_order_code, 
      base_order_date, register_man_id, register_man_code, 
      register_man_name, consumer_name, sex, 
      age, id_num, quantity_total, 
      varieties_quantity, amount_total, whole_discount, 
      whole_discount_amount, real_amount_total, notax_real_amount_total, 
      tax_amount_total, profit_total, notax_profit_total, 
      profit_rate, notax_profit_rate, status, 
      remark, creater_id, creater_code, 
      creater_name, create_time, modifier_id, 
      modifier_code, modifier_name, update_time
      )
    values (#{id,jdbcType=BIGINT}, #{enterpriseId,jdbcType=BIGINT}, #{parentId,jdbcType=BIGINT}, 
      #{orderType,jdbcType=INTEGER}, #{registerDate,jdbcType=TIMESTAMP}, #{code,jdbcType=VARCHAR}, 
      #{baseOrderId,jdbcType=BIGINT}, #{baseOrderType,jdbcType=INTEGER}, #{baseOrderCode,jdbcType=VARCHAR}, 
      #{baseOrderDate,jdbcType=TIMESTAMP}, #{registerManId,jdbcType=BIGINT}, #{registerManCode,jdbcType=VARCHAR}, 
      #{registerManName,jdbcType=VARCHAR}, #{consumerName,jdbcType=VARCHAR}, #{sex,jdbcType=INTEGER}, 
      #{age,jdbcType=INTEGER}, #{idNum,jdbcType=VARCHAR}, #{quantityTotal,jdbcType=DECIMAL}, 
      #{varietiesQuantity,jdbcType=INTEGER}, #{amountTotal,jdbcType=DECIMAL}, #{wholeDiscount,jdbcType=DECIMAL}, 
      #{wholeDiscountAmount,jdbcType=DECIMAL}, #{realAmountTotal,jdbcType=DECIMAL}, #{notaxRealAmountTotal,jdbcType=DECIMAL}, 
      #{taxAmountTotal,jdbcType=DECIMAL}, #{profitTotal,jdbcType=DECIMAL}, #{notaxProfitTotal,jdbcType=DECIMAL}, 
      #{profitRate,jdbcType=DECIMAL}, #{notaxProfitRate,jdbcType=DECIMAL}, #{status,jdbcType=INTEGER}, 
      #{remark,jdbcType=VARCHAR}, #{createrId,jdbcType=BIGINT}, #{createrCode,jdbcType=VARCHAR}, 
      #{createrName,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{modifierId,jdbcType=BIGINT}, 
      #{modifierCode,jdbcType=VARCHAR}, #{modifierName,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.rograndec.feijiayun.chain.business.retail.special.entity.SpecialRegister" useGeneratedKeys="true" keyProperty="id">
    insert into saas_special_register
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="enterpriseId != null">
        enterprise_id,
      </if>
      <if test="parentId != null">
        parent_id,
      </if>
      <if test="orderType != null">
        order_type,
      </if>
      <if test="registerDate != null">
        register_date,
      </if>
      <if test="code != null">
        code,
      </if>
      <if test="baseOrderId != null">
        base_order_id,
      </if>
      <if test="baseOrderType != null">
        base_order_type,
      </if>
      <if test="baseOrderCode != null">
        base_order_code,
      </if>
      <if test="baseOrderDate != null">
        base_order_date,
      </if>
      <if test="registerManId != null">
        register_man_id,
      </if>
      <if test="registerManCode != null">
        register_man_code,
      </if>
      <if test="registerManName != null">
        register_man_name,
      </if>
      <if test="memberId != null">
        member_id,
      </if>
      <if test="memberCardCode != null">
        member_card_code,
      </if>
      <if test="memberName != null">
        member_name,
      </if>
      <if test="consumerName != null">
        consumer_name,
      </if>
      <if test="sex != null">
        sex,
      </if>
      <if test="age != null">
        age,
      </if>
      <if test="idNum != null">
        id_num,
      </if>
      <if test="quantityTotal != null">
        quantity_total,
      </if>
      <if test="varietiesQuantity != null">
        varieties_quantity,
      </if>
      <if test="amountTotal != null">
        amount_total,
      </if>
      <if test="wholeDiscount != null">
        whole_discount,
      </if>
      <if test="wholeDiscountAmount != null">
        whole_discount_amount,
      </if>
      <if test="realAmountTotal != null">
        real_amount_total,
      </if>
      <if test="notaxRealAmountTotal != null">
        notax_real_amount_total,
      </if>
      <if test="taxAmountTotal != null">
        tax_amount_total,
      </if>
      <if test="profitTotal != null">
        profit_total,
      </if>
      <if test="notaxProfitTotal != null">
        notax_profit_total,
      </if>
      <if test="profitRate != null">
        profit_rate,
      </if>
      <if test="notaxProfitRate != null">
        notax_profit_rate,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="createrId != null">
        creater_id,
      </if>
      <if test="createrCode != null">
        creater_code,
      </if>
      <if test="createrName != null">
        creater_name,
      </if>
      <if test="createTime != null">
		create_time,
	  </if>
      <if test="modifierId != null">
        modifier_id,
      </if>
      <if test="modifierCode != null">
        modifier_code,
      </if>
      <if test="modifierName != null">
        modifier_name,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="enterpriseId != null">
        #{enterpriseId,jdbcType=BIGINT},
      </if>
      <if test="parentId != null">
        #{parentId,jdbcType=BIGINT},
      </if>
      <if test="orderType != null">
        #{orderType,jdbcType=INTEGER},
      </if>
      <if test="registerDate != null">
        #{registerDate,jdbcType=TIMESTAMP},
      </if>
      <if test="code != null">
        #{code,jdbcType=VARCHAR},
      </if>
      <if test="baseOrderId != null">
        #{baseOrderId,jdbcType=BIGINT},
      </if>
      <if test="baseOrderType != null">
        #{baseOrderType,jdbcType=INTEGER},
      </if>
      <if test="baseOrderCode != null">
        #{baseOrderCode,jdbcType=VARCHAR},
      </if>
      <if test="baseOrderDate != null">
        #{baseOrderDate,jdbcType=TIMESTAMP},
      </if>
      <if test="registerManId != null">
        #{registerManId,jdbcType=BIGINT},
      </if>
      <if test="registerManCode != null">
        #{registerManCode,jdbcType=VARCHAR},
      </if>
      <if test="registerManName != null">
        #{registerManName,jdbcType=VARCHAR},
      </if>
      <if test="memberId != null">
        #{memberId,jdbcType=BIGINT},
      </if>
      <if test="memberCardCode != null">
        #{memberCardCode,jdbcType=VARCHAR},
      </if>
      <if test="memberName != null">
        #{memberName,jdbcType=VARCHAR},
      </if>
      <if test="consumerName != null">
        #{consumerName,jdbcType=VARCHAR},
      </if>
      <if test="sex != null">
        #{sex,jdbcType=INTEGER},
      </if>
      <if test="age != null">
        #{age,jdbcType=INTEGER},
      </if>
      <if test="idNum != null">
        #{idNum,jdbcType=VARCHAR},
      </if>
      <if test="quantityTotal != null">
        #{quantityTotal,jdbcType=DECIMAL},
      </if>
      <if test="varietiesQuantity != null">
        #{varietiesQuantity,jdbcType=INTEGER},
      </if>
      <if test="amountTotal != null">
        #{amountTotal,jdbcType=DECIMAL},
      </if>
      <if test="wholeDiscount != null">
        #{wholeDiscount,jdbcType=DECIMAL},
      </if>
      <if test="wholeDiscountAmount != null">
        #{wholeDiscountAmount,jdbcType=DECIMAL},
      </if>
      <if test="realAmountTotal != null">
        #{realAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="notaxRealAmountTotal != null">
        #{notaxRealAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="taxAmountTotal != null">
        #{taxAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="profitTotal != null">
        #{profitTotal,jdbcType=DECIMAL},
      </if>
      <if test="notaxProfitTotal != null">
        #{notaxProfitTotal,jdbcType=DECIMAL},
      </if>
      <if test="profitRate != null">
        #{profitRate,jdbcType=DECIMAL},
      </if>
      <if test="notaxProfitRate != null">
        #{notaxProfitRate,jdbcType=DECIMAL},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createrId != null">
        #{createrId,jdbcType=BIGINT},
      </if>
      <if test="createrCode != null">
        #{createrCode,jdbcType=VARCHAR},
      </if>
      <if test="createrName != null">
        #{createrName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
		#{createTime,jdbcType=TIMESTAMP},
	  </if>
      <if test="modifierId != null">
        #{modifierId,jdbcType=BIGINT},
      </if>
      <if test="modifierCode != null">
        #{modifierCode,jdbcType=VARCHAR},
      </if>
      <if test="modifierName != null">
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.rograndec.feijiayun.chain.business.retail.special.entity.SpecialRegister">
    update saas_special_register
    <set>
      <if test="enterpriseId != null">
        enterprise_id = #{enterpriseId,jdbcType=BIGINT},
      </if>
      <if test="parentId != null">
        parent_id = #{parentId,jdbcType=BIGINT},
      </if>
      <if test="orderType != null">
        order_type = #{orderType,jdbcType=INTEGER},
      </if>
      <if test="registerDate != null">
        register_date = #{registerDate,jdbcType=TIMESTAMP},
      </if>
      <if test="code != null">
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="baseOrderId != null">
        base_order_id = #{baseOrderId,jdbcType=BIGINT},
      </if>
      <if test="baseOrderType != null">
        base_order_type = #{baseOrderType,jdbcType=INTEGER},
      </if>
      <if test="baseOrderCode != null">
        base_order_code = #{baseOrderCode,jdbcType=VARCHAR},
      </if>
      <if test="baseOrderDate != null">
        base_order_date = #{baseOrderDate,jdbcType=TIMESTAMP},
      </if>
      <if test="registerManId != null">
        register_man_id = #{registerManId,jdbcType=BIGINT},
      </if>
      <if test="registerManCode != null">
        register_man_code = #{registerManCode,jdbcType=VARCHAR},
      </if>
      <if test="registerManName != null">
        register_man_name = #{registerManName,jdbcType=VARCHAR},
      </if>
      <if test="memberId != null">
        member_id=#{memberId,jdbcType=BIGINT},
      </if>
      <if test="memberCardCode != null">
        member_card_code=#{memberCardCode,jdbcType=VARCHAR},
      </if>
      <if test="memberName != null">
        member_name=#{memberName,jdbcType=VARCHAR},
      </if>
      <if test="consumerName != null">
        consumer_name = #{consumerName,jdbcType=VARCHAR},
      </if>
      <if test="sex != null">
        sex = #{sex,jdbcType=INTEGER},
      </if>
      <if test="age != null">
        age = #{age,jdbcType=INTEGER},
      </if>
      <if test="idNum != null">
        id_num = #{idNum,jdbcType=VARCHAR},
      </if>
      <if test="quantityTotal != null">
        quantity_total = #{quantityTotal,jdbcType=DECIMAL},
      </if>
      <if test="varietiesQuantity != null">
        varieties_quantity = #{varietiesQuantity,jdbcType=INTEGER},
      </if>
      <if test="amountTotal != null">
        amount_total = #{amountTotal,jdbcType=DECIMAL},
      </if>
      <if test="wholeDiscount != null">
        whole_discount = #{wholeDiscount,jdbcType=DECIMAL},
      </if>
      <if test="wholeDiscountAmount != null">
        whole_discount_amount = #{wholeDiscountAmount,jdbcType=DECIMAL},
      </if>
      <if test="realAmountTotal != null">
        real_amount_total = #{realAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="notaxRealAmountTotal != null">
        notax_real_amount_total = #{notaxRealAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="taxAmountTotal != null">
        tax_amount_total = #{taxAmountTotal,jdbcType=DECIMAL},
      </if>
      <if test="profitTotal != null">
        profit_total = #{profitTotal,jdbcType=DECIMAL},
      </if>
      <if test="notaxProfitTotal != null">
        notax_profit_total = #{notaxProfitTotal,jdbcType=DECIMAL},
      </if>
      <if test="profitRate != null">
        profit_rate = #{profitRate,jdbcType=DECIMAL},
      </if>
      <if test="notaxProfitRate != null">
        notax_profit_rate = #{notaxProfitRate,jdbcType=DECIMAL},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createrId != null">
        creater_id = #{createrId,jdbcType=BIGINT},
      </if>
      <if test="createrCode != null">
        creater_code = #{createrCode,jdbcType=VARCHAR},
      </if>
      <if test="createrName != null">
        creater_name = #{createrName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierId != null">
        modifier_id = #{modifierId,jdbcType=BIGINT},
      </if>
      <if test="modifierCode != null">
        modifier_code = #{modifierCode,jdbcType=VARCHAR},
      </if>
      <if test="modifierName != null">
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.rograndec.feijiayun.chain.business.retail.special.entity.SpecialRegister">
    update saas_special_register
    set enterprise_id = #{enterpriseId,jdbcType=BIGINT},
      parent_id = #{parentId,jdbcType=BIGINT},
      order_type = #{orderType,jdbcType=INTEGER},
      register_date = #{registerDate,jdbcType=TIMESTAMP},
      code = #{code,jdbcType=VARCHAR},
      base_order_id = #{baseOrderId,jdbcType=BIGINT},
      base_order_type = #{baseOrderType,jdbcType=INTEGER},
      base_order_code = #{baseOrderCode,jdbcType=VARCHAR},
      base_order_date = #{baseOrderDate,jdbcType=TIMESTAMP},
      register_man_id = #{registerManId,jdbcType=BIGINT},
      register_man_code = #{registerManCode,jdbcType=VARCHAR},
      register_man_name = #{registerManName,jdbcType=VARCHAR},
      consumer_name = #{consumerName,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      age = #{age,jdbcType=INTEGER},
      id_num = #{idNum,jdbcType=VARCHAR},
      quantity_total = #{quantityTotal,jdbcType=DECIMAL},
      varieties_quantity = #{varietiesQuantity,jdbcType=INTEGER},
      amount_total = #{amountTotal,jdbcType=DECIMAL},
      whole_discount = #{wholeDiscount,jdbcType=DECIMAL},
      whole_discount_amount = #{wholeDiscountAmount,jdbcType=DECIMAL},
      real_amount_total = #{realAmountTotal,jdbcType=DECIMAL},
      notax_real_amount_total = #{notaxRealAmountTotal,jdbcType=DECIMAL},
      tax_amount_total = #{taxAmountTotal,jdbcType=DECIMAL},
      profit_total = #{profitTotal,jdbcType=DECIMAL},
      notax_profit_total = #{notaxProfitTotal,jdbcType=DECIMAL},
      profit_rate = #{profitRate,jdbcType=DECIMAL},
      notax_profit_rate = #{notaxProfitRate,jdbcType=DECIMAL},
      status = #{status,jdbcType=INTEGER},
      remark = #{remark,jdbcType=VARCHAR},
      creater_id = #{createrId,jdbcType=BIGINT},
      creater_code = #{createrCode,jdbcType=VARCHAR},
      creater_name = #{createrName,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      modifier_id = #{modifierId,jdbcType=BIGINT},
      modifier_code = #{modifierCode,jdbcType=VARCHAR},
      modifier_name = #{modifierName,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>


  <!--查询条件-->
  <sql id="whereSql">
    <where>
    <if test="status != null and status != ''">and ssr.status=#{status}</if>
    <if test="enterpriseId != null and enterpriseId != ''">and ssr.enterprise_id=#{enterpriseId}</if>
    <if test="startDate != null and startDate != ''">and ssr.register_date>=str_to_date(#{startDate},'%Y-%m-%d %T')</if>
    <if test="endDate != null and endDate != ''">and str_to_date(#{endDate},'%Y-%m-%d %T')>=ssr.register_date</if>
    <if test="code != null and code != ''">and ssr.code like CONCAT('%',#{code},'%')</if>
    <if test="registerManName != null and registerManName!=''">and ssr.register_man_name like CONCAT('%',#{registerManName},'%')</if>
    <if test="consumerName != null and consumerName != ''">and ssr.consumer_name=#{consumerName}</if>
    </where>

  </sql>
  <!--根据条件查询专管登记单记录数-->
  <select id="countSpecialRegisterData" parameterType="com.rograndec.feijiayun.chain.business.retail.special.vo.RequestSpecialRegisterVo" resultType="int">
    select
    count(*)
    from
    saas_special_register ssr
    left join
    saas_sale ss on ss.id=ssr.base_order_id
    <include refid="whereSql" />
    <if test="sort != null and sort != ''">
      order by ${sort}
    </if>
  </select>
  <!--根据条件查询专管登记单数据记录集合-->
  <select id="listSpecialRegisterData"  parameterType="com.rograndec.feijiayun.chain.business.retail.special.vo.RequestSpecialRegisterVo" resultMap="SpecialRegisterVo">
    select
      ssr.id,
      ssr.enterprise_id,
      ssr.parent_id,
      ssr.order_type,
      ssr.register_date,
      ssr.code,
      ssr.base_order_id,
      ssr.base_order_type,
      ssr.base_order_code,
      ssr.base_order_date,
      ssr.register_man_id,
      ssr.register_man_code,
      ssr.register_man_name,
      ssr.member_id,
      ssr.member_card_code,
      ssr.member_name,
      ssr.consumer_name,
      ssr.sex,
      ssr.age,
      ssr.id_num,
      ssr.quantity_total,
      ssr.varieties_quantity,
      ssr.amount_total,
      ssr.whole_discount,
      ssr.whole_discount_amount,
      ssr.real_amount_total,
      ssr.notax_real_amount_total,
      ssr.tax_amount_total,
      ssr.profit_total,
      ssr.notax_profit_total,
      ssr.profit_rate,
      ssr.notax_profit_rate,
      ssr.status,
      ssr.remark,
      ssr.creater_id,
      ssr.creater_code,
      ssr.creater_name,
      ssr.create_time,
      ssr.modifier_id,
      ssr.modifier_code,
      ssr.modifier_name,
      ssr.update_time,
      ss.code sale_code,
      ssr.member_card_code
    from
      saas_special_register ssr
    left join
      saas_sale ss on ss.id=ssr.base_order_id
    <include refid="whereSql" />
    <if test="sort != null and sort != ''">
      order by ${sort}
    </if>
    <if test="start != null and pageSize !=null">
      limit #{start},#{pageSize}
    </if>
  </select>

  <select id="getSpecialRegisterBySaleId" parameterType="long" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from saas_special_register
    where base_order_id=#{saleId} limit 1
  </select>


  <select id="selectSpecialRegisterDataByEnterpriseId" resultMap="POSSpecialRegisterDataResultMap">
  	select
  		r.id, r.enterprise_id as renterprise_id, r.parent_id as rparent_id,
  		r.register_date, r.code, r.member_id, r.member_card_code, r.member_name,
  		r.consumer_name, r.sex, r.age, r.id_num, r.quantity_total,
  		r.amount_total, r.whole_discount, r.whole_discount_amount, r.real_amount_total,
  		d.id as detail_id, s.id as shelf_table_id, s.enterprise_id as senterprise_id,
    	s.parent_id as sparent_id, d.goods_id, d.goods_code, d.goods_name,
    	d.goods_generic_name, d.dosage_name, d.unit_name, d.goods_specification,
    	d.manufacturer, d.single_dose, d.quantity, d.unit_price,
    	d.line_discount, d.amount, s.lot_number, s.product_date,
    	s.valid_date, s.shelf_id, s.shelf_name
  			from
  	saas_special_register_shelf s left join saas_special_register_detail d
  		on s.register_dtl_id = d.id
  	left join saas_special_register r
  		on s.register_id = r.id
  	where r.enterprise_id = #{enterpriseId,jdbcType=BIGINT}
    	and r.status = #{status}			
  </select>
  
  
   <select id="getSpecialRegisterReportList" parameterType="com.rograndec.feijiayun.chain.business.report.quality.retail.vo.RequestSpecialRegisterVO" resultType="com.rograndec.feijiayun.chain.business.report.quality.retail.vo.SpecialRegisterReportVO">
		SELECT shelf.`id`,e.`id` AS enterpriseId,e.`code` AS enterpriseCode,e.`name` AS enterpriseName,
		reg.`code` AS registerCode,reg.`register_date` AS registerDate,reg.`register_man_id` AS registerManId,
		reg.`register_man_name` AS registerManName,reg.`member_card_code` AS memberCardCode,reg.`consumer_name` AS consumerName,
		reg.`sex` AS sex,reg.`age` AS age,reg.`id_num` AS idNum,reg.`base_order_code` AS saleCode,
		detail.`goods_id` AS goodsId,detail.`goods_code` AS goodsCode,detail.`barcode` AS barcode,detail.`goods_name` AS goodsName,
		detail.`goods_generic_name` AS goodsGenericName,detail.`dosage_id` AS dosageId,detail.`dosage_name` AS dosageName,
		detail.`unit_id` AS unitId,detail.`unit_name` AS unitName,detail.`goods_specification` AS goodsSpecification,
		detail.`manufacturer_id` AS manufacturerId,detail.`manufacturer` AS manufacturer,detail.`goods_place` AS goodsPlace,
		detail.`approval_number` AS approvalNumber,
		shelf.`lot_number` AS lotNumber,shelf.`product_date` AS productDate,
		shelf.`valid_date` AS validUntil,shelf.`shelf_id` AS shelfId,shelf.`shelf_name` AS shelfName,
		cargo.`job_type` AS jobType,cargo.`job_area` AS jobArea,
		shelf.`quantity`,shelf.`unit_price` AS unitPrice,shelf.`line_discount` AS lineDiscount,shelf.`amount` AS amount,
		shelf.`whole_discount` AS wholeDiscount,shelf.`line_discount_amount` AS lineDiscountAmount,shelf.`real_price` AS realPrice,
		shelf.`real_amount` AS realAmount,shelf.`tax_rate` AS taxRate,shelf.`notax_real_price` AS notaxRealPrice,
		shelf.`notax_real_amount` AS notaxRealAmount,shelf.`tax_amount` AS taxAmount,shelf.`status` AS `status`,
		goods.`business_variety` AS businessVariety,cate.id AS categoryId,
		cate.name AS categoryName,goods.`goods_attribute` AS goodsAttribute,goods.`prescription_drug` AS prescriptionDrug,
		goods.`otc_type` AS otcType,goods.`domestic_import` AS domesticImport, goods.`management_scope_id` AS managemenScopeId,
		goods.`management_scope_name` AS managementScopeName,goods.`special_drug` AS specialDrug,
		goods.`in_charge_drug` AS inChargeDrug, goods.`limit_quantity` AS limitQuantity,
		goods.`storage_temp` AS storageTemp,
		goods.`storage_condition_name` AS storageConditionName,goods.`quality_period` AS qualityPeriod, 
		goods.`quality_period_unit` AS qualityPeriodUnit
		,goods.`spirit_drug_type` AS spiritDrugType,goods.`formulation_type` AS formulationType,goods.`cosmetics`
		FROM `saas_special_register_shelf` shelf 
		LEFT JOIN `saas_special_register_detail` detail ON detail.`id`=shelf.`register_dtl_id`
		LEFT JOIN `saas_special_register` reg ON reg.`id`=shelf.`register_id`
		LEFT JOIN `saas_enterprise` e ON e.`id`=shelf.`enterprise_id`
		LEFT JOIN `saas_warehouse_shelf` wf ON wf.`id`=shelf.`shelf_id`
		LEFT JOIN `saas_warehouse_cargo_area` cargo ON cargo.`id`=wf.`cargo_area_id`
		LEFT JOIN `saas_goods` goods ON goods.`id`=detail.`goods_id`
		LEFT JOIN `saas_goods_category` cate ON cate.id=goods.`category_id`
		WHERE 1=1
		AND (shelf.`enterprise_id`= #{enterpriseId} OR shelf.`parent_id`=#{enterpriseId})
	<include refid="GoodsNearEffectParams"/>
	 <if test="dateOrder==0 and codeOrder==0">
	 ORDER BY reg.`register_date` DESC , reg.`code` DESC   
	 </if>
	  <if test="dateOrder==0 and codeOrder==1">
	 ORDER BY reg.`register_date` DESC , reg.`code`   
	 </if>
	  <if test="dateOrder==1 and codeOrder==0">
	 ORDER BY reg.`register_date`, reg.`code` DESC   
	 </if>
	  <if test="dateOrder==1 and codeOrder==1">
	 ORDER BY reg.`register_date`, reg.`code` 
	 </if>
	 <if test="start!=null and pageSize!=null">
	 LIMIT #{start},#{pageSize}
	 </if>
  </select>
  <sql id="GoodsNearEffectParams">
  	<if test="param != null and param != ''">
         AND (
      INSTR(detail.`goods_name`,#{param})
      OR INSTR(detail.`goods_code`,#{param})
      OR INSTR(detail.`approval_number`,#{param})
      OR INSTR(detail.`barcode`,#{param})
      OR INSTR(detail.`goods_generic_name`,#{param})
      )
    </if>
     <if test="businessVariety != null">
      AND goods.`business_variety` = #{businessVariety}
    </if>
    <if test="categoryId != null">
      AND goods.category_id = #{categoryId}
    </if>
    <if test="domesticImport != null">
      AND goods.domestic_import = #{domesticImport}
    </if>
     <if test="storageTemp != null">
      AND goods.storage_temp = #{storageTemp}
    </if>
     <if test="storageConditionName != null and storageConditionName!='' ">
      AND goods.`storage_condition_name` like concat('%', #{storageConditionName},'%')
    </if>
    <if test="registeredTrademark != null and registeredTrademark!='' ">
      AND goods.registered_trademark = #{registeredTrademark}
    </if>
    <if test="brand != null and brand!='' ">
      AND goods.brand = #{brand}
    </if>
    <if test="goodsAttribute != null">
      AND goods.goods_attribute = #{goodsAttribute}
    </if>
     <if test="prescriptionDrug != null">
      AND goods.prescription_drug = #{prescriptionDrug}
    </if>
     <if test="otcType != null">
      AND goods.otc_type = #{otcType}
    </if>
     <if test="cosmetics != null">
      AND goods.cosmetics = #{cosmetics}
    </if>
     <if test="managementScopeId != null">
      AND goods.management_scope_id = #{managementScopeId}
    </if>
     <if test="specialDrug != null">
      AND goods.special_drug = #{specialDrug}
    </if>
    <if test="inChargeDrug != null">
      AND goods.in_charge_drug = #{inChargeDrug}
    </if>
    
    <if test="spiritDrugType != null">
	  AND goods.spirit_drug_type = #{spiritDrugType}
	</if>
	<if test="formulationType != null">
	  AND goods.formulation_type = #{formulationType}
	</if>
    
    <if test="startDate!=null and endDate!=null">
     AND ( reg.`register_date` BETWEEN #{startDate} AND #{endDate} )
    </if>
    <if test="startDate!=null and endDate==null">
    AND reg.`register_date` <![CDATA[>=]]> #{startDate}
    </if>
    <if test="startDate==null and endDate!=null">
    AND reg.`register_date` <![CDATA[<=]]> #{endDate}
    </if>
    
    <if test="registerCode!=null and registerCode!='' ">
    AND reg.`code`=#{registerCode}
    </if>
    <if test="registerManName!=null and registerManName!='' ">
    AND reg.`register_man_name`=#{registerManName}
    </if>
     <if test="memberCardCode!=null and memberCardCode!='' ">
    AND reg.`member_card_code`=#{memberCardCode}
    </if>
     <if test="consumerName!=null and consumerName!='' ">
    AND reg.`consumer_name`=#{consumerName}
    </if>
    
    <if test="status!=null">
     AND shelf.`status`=#{status}
    </if>
    
    <if test="chainType != null">
      AND e.chain_type = #{chainType}
    </if>
    <if test="enterpriseCode != null and enterpriseCode!='' ">
      AND e.code = #{enterpriseCode}
    </if>
    <if test="enterpriseName != null and enterpriseName!='' ">
      AND e.name like concat('%', #{enterpriseName},'%')
    </if>
  </sql>
  
  <select id="getSpecialRegisterReportListTotalNum" parameterType="com.rograndec.feijiayun.chain.business.report.quality.retail.vo.RequestSpecialRegisterVO" resultType="java.lang.Integer">
	SELECT COUNT(shelf.`id`)
	FROM `saas_special_register_shelf` shelf 
		LEFT JOIN `saas_special_register_detail` detail ON detail.`id`=shelf.`register_dtl_id`
		LEFT JOIN `saas_special_register` reg ON reg.`id`=shelf.`register_id`
		LEFT JOIN `saas_enterprise` e ON e.`id`=shelf.`enterprise_id`
		LEFT JOIN `saas_warehouse_shelf` wf ON wf.`id`=shelf.`shelf_id`
		LEFT JOIN `saas_warehouse_cargo_area` cargo ON cargo.`id`=wf.`cargo_area_id`
		LEFT JOIN `saas_goods` goods ON goods.`id`=detail.`goods_id`
		LEFT JOIN `saas_goods_category` cate ON cate.id=goods.`category_id`
		WHERE 1=1
		AND (shelf.`enterprise_id`= #{enterpriseId} OR shelf.`parent_id`=#{enterpriseId})
	<include refid="GoodsNearEffectParams"/>
  </select>
  
  <select id="getPrescriptionReportVo"  parameterType="com.rograndec.feijiayun.chain.business.report.quality.retail.vo.RequestSpecialRegisterVO"  resultType="com.rograndec.feijiayun.chain.business.report.quality.retail.vo.PrescriptionReportVO">
	  SELECT 
	  SUM(shelf.`quantity`) AS quantity,SUM(shelf.`amount`) AS amount,SUM(shelf.`real_amount`) AS realAmountTotal,
	  SUM(shelf.`notax_real_amount`) AS notaxRealAmountTotal,SUM(shelf.`tax_amount`) AS taxAmountTotal 
	FROM
	  `saas_special_register_shelf` shelf 
	  LEFT JOIN `saas_special_register_detail` detail 
	    ON detail.`id` = shelf.`register_dtl_id` 
	  LEFT JOIN `saas_special_register` reg 
	    ON reg.`id` = shelf.`register_id` 
	  LEFT JOIN `saas_enterprise` e 
	    ON e.`id` = shelf.`enterprise_id` 
	  LEFT JOIN `saas_warehouse_shelf` wf 
	    ON wf.`id` = shelf.`shelf_id` 
	  LEFT JOIN `saas_warehouse_cargo_area` cargo 
	    ON cargo.`id` = wf.`cargo_area_id` 
	  LEFT JOIN `saas_goods` goods 
	    ON goods.`id` = detail.`goods_id` 
	  LEFT JOIN `saas_goods_category` cate 
	    ON cate.id = goods.`category_id` 
	WHERE 1 = 1 
	AND (shelf.`enterprise_id`= #{enterpriseId} OR shelf.`parent_id`=#{enterpriseId})
	<include refid="GoodsNearEffectParams"/>
  </select>
  
</mapper>